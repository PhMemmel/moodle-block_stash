{"version":3,"file":"trade-snippet-dialogue.min.js","sources":["../src/trade-snippet-dialogue.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Drop snippet dialogue module.\n *\n * @copyright  2016 Frédéric Massart - FMCorz.net\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'core/templates',\n    'block_stash/dialogue-base',\n    'core/ajax',\n], function(Templates, DialogueBase, ajax) {\n\n    /**\n     * Snippet dialogue class.\n     *\n     * @param {Trade} trade The trade widget.\n     * @param {Array} warnings List of warnings.\n     * @param {String} altSnippetMaker The name of the alternate snippet maker module.\n     */\n    function Dialog(trade, warnings, altSnippetMaker) {\n        window.console.log('other');\n        this._trade = trade;\n        this._warnings = warnings;\n        this._altSnippetMaker = altSnippetMaker;\n        this.setTitle(trade.get('name'));\n        DialogueBase.prototype.constructor.apply(this, []);\n    }\n    Dialog.prototype = Object.create(DialogueBase.prototype);\n    Dialog.prototype.constructor = Dialog;\n\n    Dialog.prototype._trade = null;\n    Dialog.prototype._warnings = null;\n\n    /**\n     * Render the dialogue.\n     *\n     * @method _render\n     * @return {Promise}\n     */\n    Dialog.prototype._render = function() {\n        var context = {\n            trade: this._trade.getData(),\n            tradejson: JSON.stringify(this._trade.getData()),\n            warnings: this._warnings,\n            haswarnings: this._warnings && this._warnings.length,\n            altsnippetmaker: this._altSnippetMaker\n        };\n\n        return ajax.call([\n            {methodname: 'block_stash_get_trade_items', args: {\n                tradeid: this._trade.get('id')\n            }}\n        ])[0].then(function(stuff) {\n            context.tradeitems = stuff;\n            Templates.render('block_stash/trade_snippet_dialogue', context)\n            .then(function(html, js) {\n                this._setDialogueContent(html);\n                this.center();\n                Templates.runTemplateJS(js);\n            }.bind(this));\n\n        }.bind(this));\n\n    };\n\n    return /** @alias module:block_stash/drop-snippet-dialogue */ Dialog;\n\n});\n"],"names":["define","Templates","DialogueBase","ajax","Dialog","trade","warnings","altSnippetMaker","window","console","log","_trade","_warnings","_altSnippetMaker","setTitle","get","prototype","constructor","apply","this","Object","create","_render","context","getData","tradejson","JSON","stringify","haswarnings","length","altsnippetmaker","call","methodname","args","tradeid","then","stuff","tradeitems","render","html","js","_setDialogueContent","center","runTemplateJS","bind"],"mappings":";;;;;;AAsBAA,4CAAO,CACH,iBACA,4BACA,cACD,SAASC,UAAWC,aAAcC,eASxBC,OAAOC,MAAOC,SAAUC,iBAC7BC,OAAOC,QAAQC,IAAI,cACdC,OAASN,WACTO,UAAYN,cACZO,iBAAmBN,qBACnBO,SAAST,MAAMU,IAAI,SACxBb,aAAac,UAAUC,YAAYC,MAAMC,KAAM,WAEnDf,OAAOY,UAAYI,OAAOC,OAAOnB,aAAac,WAC9CZ,OAAOY,UAAUC,YAAcb,OAE/BA,OAAOY,UAAUL,OAAS,KAC1BP,OAAOY,UAAUJ,UAAY,KAQ7BR,OAAOY,UAAUM,QAAU,eACnBC,QAAU,CACVlB,MAAOc,KAAKR,OAAOa,UACnBC,UAAWC,KAAKC,UAAUR,KAAKR,OAAOa,WACtClB,SAAUa,KAAKP,UACfgB,YAAaT,KAAKP,WAAaO,KAAKP,UAAUiB,OAC9CC,gBAAiBX,KAAKN,yBAGnBV,KAAK4B,KAAK,CACb,CAACC,WAAY,8BAA+BC,KAAM,CAC9CC,QAASf,KAAKR,OAAOI,IAAI,UAE9B,GAAGoB,KAAK,SAASC,OAChBb,QAAQc,WAAaD,MACrBnC,UAAUqC,OAAO,qCAAsCf,SACtDY,KAAK,SAASI,KAAMC,SACZC,oBAAoBF,WACpBG,SACLzC,UAAU0C,cAAcH,KAC1BI,KAAKzB,QAETyB,KAAKzB,QAImDf"}