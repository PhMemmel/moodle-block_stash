{"version":3,"file":"dialogue-base.min.js","sources":["../src/dialogue-base.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Show item detail.\n *\n * @copyright  2016 Adrian Greeve <adriangreeve.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n    'core/yui',\n    'core/str',\n], function($, Y, Str) {\n\n    /**\n     * Constructor.\n     *\n     * Override it to inject your arguments.\n     */\n    function DialogueBase() {\n        var deferred = $.Deferred();\n        this._ready = deferred.promise();\n        Y.use('moodle-core-notification', function() {\n            this._init().then(function() {\n                deferred.resolve();\n            });\n        }.bind(this));\n    }\n\n    DialogueBase.prototype._dialogue = null;\n    DialogueBase.prototype._ready = null;\n    DialogueBase.prototype._title = '&hellip;';\n\n    /**\n     * Center the dialogue on screen.\n     */\n    DialogueBase.prototype.center = function() {\n        this._dialogue.centerDialogue();\n    };\n\n    /**\n     * Initialise the things.\n     *\n     * @return {Void}\n     */\n    DialogueBase.prototype._init = function() {\n        var deferred = $.Deferred(),\n            loading = Y.Node.create('<p style=\"text-align: center;\"><img src=\"' + M.util.image_url('y/loading') + '\" alt=\"\"></p>'),\n            d;\n\n        // New dialogue.\n        d = new M.core.dialogue({\n            draggable: true,\n            modal: true,\n            width: '600px',\n        });\n        this._dialogue = d;\n\n        // Destroy on hide.\n        var origHide = d.hide;\n        d.hide = function() {\n            origHide.apply(d, arguments);\n            this.destroy();\n        }.bind(d);\n\n        // Set content.\n        d.getStdModNode(Y.WidgetStdMod.HEADER).prepend(Y.Node.create('<h1>'));\n        this._updateDialogueTitle();\n        this._setDialogueContent(loading);\n        deferred.resolve();\n\n        // Render the things.\n        this._render().fail(function() {\n            Str.get_string('error', 'core')\n            .then(function(a) {\n                return a;\n            })\n            .fail(function() {\n                return '';\n            })\n            .always(function(txt) {\n                this._setDialogueContent(txt);\n            }.bind(this));\n        }.bind(this));\n\n        // Return the promise.\n        return deferred.promise();\n    };\n\n    DialogueBase.prototype.close = function() {\n        this._dialogue.destroy();\n    };\n\n    /**\n     * Find a node in this Dialog.\n     *\n     * @param {String} selector The selector.\n     * @return {Node}\n     */\n    DialogueBase.prototype.find = function(selector) {\n        return this._container.find(selector);\n    };\n\n    /**\n     * Render mechanics.\n     *\n     * This is the method to override to set the content of the dialogue.\n     * It must be non-blocking. Also do not forget to center the dialogue.\n     */\n    DialogueBase.prototype._render = function() {\n        // Nothing here.\n    };\n\n    /**\n     * Initialise the things.\n     *\n     * @param {Event} e The event.\n     */\n    DialogueBase.prototype.show = function(e) {\n        this._ready.then(function() {\n            this._dialogue.show(e);\n        }.bind(this));\n    };\n\n    /**\n     * Set the dialogue content.\n     *\n     * @param {String} content The HTML content.\n     */\n    DialogueBase.prototype._setDialogueContent = function(content) {\n        this._dialogue.setStdModContent(Y.WidgetStdMod.BODY, content, Y.WidgetStdMod.REPLACE);\n    };\n\n    /**\n     * Set the dialogue title.\n     *\n     * @param {String} title The title.\n     */\n    DialogueBase.prototype.setTitle = function(title) {\n        this._title = title;\n        this._updateDialogueTitle();\n    };\n\n    /**\n     * Update the dialogue title.\n     */\n    DialogueBase.prototype._updateDialogueTitle = function() {\n        if (!this._dialogue) {\n            return;\n        }\n\n        this._dialogue.getStdModNode(Y.WidgetStdMod.HEADER).one('h1').setHTML(this._title);\n    };\n\n    return DialogueBase;\n\n});\n"],"names":["define","$","Y","Str","DialogueBase","deferred","Deferred","_ready","promise","use","_init","then","resolve","bind","this","prototype","_dialogue","_title","center","centerDialogue","d","loading","Node","create","M","util","image_url","core","dialogue","draggable","modal","width","origHide","hide","apply","arguments","destroy","getStdModNode","WidgetStdMod","HEADER","prepend","_updateDialogueTitle","_setDialogueContent","_render","fail","get_string","a","always","txt","close","find","selector","_container","show","e","content","setStdModContent","BODY","REPLACE","setTitle","title","one","setHTML"],"mappings":";;;;;;AAsBAA,mCAAO,CACH,SACA,WACA,aACD,SAASC,EAAGC,EAAGC,cAOLC,mBACDC,SAAWJ,EAAEK,gBACZC,OAASF,SAASG,UACvBN,EAAEO,IAAI,2BAA4B,gBACzBC,QAAQC,MAAK,WACdN,SAASO,cAEfC,KAAKC,cAGXV,aAAaW,UAAUC,UAAY,KACnCZ,aAAaW,UAAUR,OAAS,KAChCH,aAAaW,UAAUE,OAAS,WAKhCb,aAAaW,UAAUG,OAAS,gBACvBF,UAAUG,kBAQnBf,aAAaW,UAAUL,MAAQ,eAGvBU,EAFAf,SAAWJ,EAAEK,WACbe,QAAUnB,EAAEoB,KAAKC,OAAO,4CAA8CC,EAAEC,KAAKC,UAAU,aAAe,iBAI1GN,EAAI,IAAII,EAAEG,KAAKC,SAAS,CACpBC,WAAW,EACXC,OAAO,EACPC,MAAO,eAENf,UAAYI,MAGbY,SAAWZ,EAAEa,YACjBb,EAAEa,KAAO,WACLD,SAASE,MAAMd,EAAGe,gBACbC,WACPvB,KAAKO,GAGPA,EAAEiB,cAAcnC,EAAEoC,aAAaC,QAAQC,QAAQtC,EAAEoB,KAAKC,OAAO,cACxDkB,4BACAC,oBAAoBrB,SACzBhB,SAASO,eAGJ+B,UAAUC,KAAK,WAChBzC,IAAI0C,WAAW,QAAS,QACvBlC,MAAK,SAASmC,UACJA,KAEVF,MAAK,iBACK,MAEVG,OAAO,SAASC,UACRN,oBAAoBM,MAC3BnC,KAAKC,QACTD,KAAKC,OAGAT,SAASG,WAGpBJ,aAAaW,UAAUkC,MAAQ,gBACtBjC,UAAUoB,WASnBhC,aAAaW,UAAUmC,KAAO,SAASC,iBAC5BrC,KAAKsC,WAAWF,KAAKC,WAShC/C,aAAaW,UAAU4B,QAAU,aASjCvC,aAAaW,UAAUsC,KAAO,SAASC,QAC9B/C,OAAOI,KAAK,gBACRK,UAAUqC,KAAKC,IACtBzC,KAAKC,QAQXV,aAAaW,UAAU2B,oBAAsB,SAASa,cAC7CvC,UAAUwC,iBAAiBtD,EAAEoC,aAAamB,KAAMF,QAASrD,EAAEoC,aAAaoB,UAQjFtD,aAAaW,UAAU4C,SAAW,SAASC,YAClC3C,OAAS2C,WACTnB,wBAMTrC,aAAaW,UAAU0B,qBAAuB,WACrC3B,KAAKE,gBAILA,UAAUqB,cAAcnC,EAAEoC,aAAaC,QAAQsB,IAAI,MAAMC,QAAQhD,KAAKG,SAGxEb"}